{
    "$id": "https://docs.digdir.no/schemas/dpi/digitalpost.schema.json",
    "$schema": "https://json-schema.org/draft-07/schema#",
    "description": "Schema for Standard business document (SBD) brukt av Digdir",
    "definitions": {
        "standardBusinessDocument": {
            "type": "object",
            "additionalProperties": false,
            "title": "standardBusinessDocument",
            "properties": {
                "standardBusinessDocumentHeader": {
                    "$ref": "https://docs.digdir.no/schemas/common/sbdh.schema.json#/definitions/standardBusinessDocumentHeader"
                },
                "digital": {
                    "$ref": "#/definitions/digital"
                }
            },
            "required": [
                "standardBusinessDocumentHeader",
                "digital"
            ]
        },
        "digital": {
            "$id": "#/definitions/digital",
            "type": "object",
            "title": "digitalpost",
            "properties": {
                "avsender": {
                    "$ref": "https://docs.digdir.no/schemas/dpi/commons.schema.json#/definitions/avsender"
                },
                "mottaker": {
                    "$ref": "https://docs.digdir.no/schemas/dpi/commons.schema.json#/definitions/personmottaker"
                },
                "dokumentpakkefingeravtrykk": {
                    "$ref": "https://docs.digdir.no/schemas/dpi/commons.schema.json#/definitions/dokumentpakkefingeravtrykk"
                },
                "maskinportentoken": {
                    "$ref": "https://docs.digdir.no/schemas/dpi/commons.schema.json#/definitions/maskinportentoken"
                },
                "sikkerhetsnivaa": {
                    "$id": "#/definitions/digitalpostInfo/sikkerhetsnivaa",
                    "title": "sikkerhetsnivaa",
                    "description": "Definerer hvilket autentiseringsnivå som kreves for at dokumentet skal åpnes",
                    "$comment": "Gyldige verdier 3,4",
                    "type": "integer",
                    "enum": [
                        3,
                        4
                    ]
                },
                "virkningsdato": {
                    "$id": "#/definitions/digitalpostInfo/virkningsdato",
                    "title": "virkningsdato",
                    "description": "Dato for når et element skal være aktivt.",
                    "$comment": "Dato for når en melding skal tilgjengeliggjøres for Innbygger i Innbygger sin postkasse. Dokumentet vil leveres til postkassen før dette tidspunkt, men ikke være synlig/tilgjengelig for Innbygger. Merk at feltet kun er en DATO og ikke kan styres på tidspunkt. Dette betyr i praksis at posten vil tilgjengeliggjøres om natten virkningsdagen og at postkassen kan bruke hele dagen på å tilggjengeliggjøre post med med samme virkningsdato.",
                    "type": "string",
                    "format": "date",
                    "examples": [
                        "2013-12-11"
                    ]
                },
                "virkningstidspunkt": {
                    "$id": "#/definitions/digitalpostInfo/virkningstidspunkt",
                    "title": "virkningstidspunkt",
                    "description": "Dato for når et element skal være aktivt.",
                    "$comment": "Dato og tidspunkt for når en melding skal tilgjengeliggjøres for Innbygger i Innbygger sin postkasse. Forsendelsen vil leveres til postkassen før dette tidspunkt, men ikke være synlig/tilgjengelig for innbygger. Tidspunktet må spesifiseres med tidssone eventuelt justeres til UTC/Z.",
                    "type": "string",
                    "format": "date-time",
                    "examples": [
                        "2015-01-30T08:00:00.000+01:00"
                    ]
                },
                "aapningskvittering": {
                    "$id": "#/definitions/digitalpostInfo/aapningskvittering",
                    "title": "aapningskvittering",
                    "description": "Definerer behovet for Åpningskvittering",
                    "$comment": "Dersom Dataansvarlig ønsker å at Innbygger aktivt skal bli bedt om å sende tilbake en Åpningskvittering ved åpning av Digital Post kan det spesifiseres med dette attributtet. Verdien JA vil kreve at Innbygger samtykker til at kvittering blir sendt tilbake til Databehandler ved åpning av den digital posten",
                    "type": "boolean",
                    "default": false
                },
                "ikkesensitivtittel": {
                    "$ref": "#/definitions/ikkesensitivtittel"
                },
                "varsler": {
                    "$id": "#/definitions/varsler",
                    "title": "varsler",
                    "description": "Informasjon om hvordan postkasseleverandør skal varsle Mottaker om den nye posten. Overstyrer Mottaker sine egne varslingspreferanser",
                    "$comment": "Varslingsinformasjonen angitt her vil overstyre Mottaker sine egne varslingspreferanser, det vil kunne komme som tillegg til Mottaker sine varslingvalg. Avsender kan med instillingene her styre både EpostVarsel og smsVarsel](SmsVarsel.md) helt uavhengig av hverandre. Det vil si at Avsender kan velge å varsle i begge eller en av kanalene. Avsender kan velge selv hvilken kanal som velges, dette kan de gjøre med bakgrunn i sin egen kanalstrategi, erfaringer i forhold til åpningsgrad og kostnader. Bruk av SmsVarsel vil medføre egne kostnader for Avsender",
                    "properties": {
                        "epostvarsel": {
                            "$ref": "#/definitions/epostvarsel"
                        },
                        "smsvarsel": {
                            "$ref": "#/definitions/smsvarsel"
                        }
                    }
                }
            },
            "required": [
                "avsender",
                "mottaker",
                "dokumentpakkefingeravtrykk",
                "maskinportentoken",
                "sikkerhetsnivaa",
                "ikkesensitivtittel"
            ],
            "additionalProperties": false
        },
        "ikkesensitivtittel": {
            "type": "object",
            "$id": "#/definitions/ikkesensitivtittel",
            "title": "ikkesensitivtittel",
            "description": "En tittel som ikke inneholder sensitiv informasjon",
            "$comment": "Vil vises til Innbygger og brukes i varslinger/påminnelser på e-post og sms til Innbygger. Skal ikke inneholde sensitiv informasjon. Kan brukes på lavere sikkerhetsnivå enn det selve dokumentet er klassifisert på.",
            "properties": {
                "tittel": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 255
                },
                "spraak": {
                    "$ref": "#/definitions/spraak"
                }
            },
            "required": [
                "tittel",
                "spraak"
            ]
        },
        "epostvarsel": {
            "type": "object",
            "$id": "#/definitions/epostvarsel",
            "title": "epostvarsel",
            "additionalProperties": false,
            "description": "Informasjon om hvordan man skal varsle sluttbruker på epost",
            "$comment": "Beskriver når det skal sendes epostvarsel fra postkassen etter at posten er tilgjengeliggjort",
            "properties": {
                "epostadresse": {
                    "type": "string",
                    "format": "email"
                },
                "varslingstekst": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 500
                },
                "spraak": {
                    "$ref": "#/definitions/spraak"
                },
                "repetisjoner": {
                    "$ref": "#/definitions/repetisjoner"
                }
            },
            "required": [
                "epostadresse",
                "varslingstekst",
                "repetisjoner",
                "spraak"
            ]
        },
        "repetisjoner": {
            "type": "array",
            "$id": "#/definitions/repetisjoner",
            "title": "repetisjoner",
            "description": "Gjentagelser etter et bestemt tidspunkt",
            "$comment": "Beskriver hvilke dager noe skal repeteres etter en definert dag, der dagerEtter angir hvor mange dager etter tidspunktet det skal repeteres. dagerEtter=0 betyr samme dag. dagerEtter=7 betyr den syvende dagen etter en bestemt dag. Det kreves at alle dagerEtter er unike. For Sikker digital post er repetisjonene knyttet opp til virkningsdato. Det vil si at dagerEtter=0 betyr samme dag som virkningsdato. dagerEtter=7 betyr den syvende dagen etter virkningsdato",
            "minItems": 1,
            "maxItems": 10,
            "items": {
                "type": "integer",
                "minimum": 0,
                "maximum": 25
            }
        },
        "varslingstekst": {
            "type": "object",
            "$id": "#/definitions/varslingstekst",
            "title": "varslingstekst",
            "description": "Tekst til Innbygger. Brukt til å sende påminnelser/varslinger for å sikre at Innbygger skaffer seg tilgang til et tilknyttet dokument.",
            "$comment": "En tekst knyttet til en digital postforsendelse. Teksten legges med i varslinger/påminnelser til Innbygger. Teksten skal ikke inneholde personopplysninger eller sensitive opplysninger da varslene sendes ukryptert pr epost eller sms."
        },
        "spraak": {
            "type": "string",
            "$id": "#/definitions/spraak",
            "title": "spraak",
            "minLength": 2,
            "maxLength": 2,
            "description": "Språkkode ihht ISO-639-1 (2 bokstaver)",
            "examples": [
                "no"
            ]
        },
        "smsvarsel": {
            "type": "object",
            "$id": "#/definitions/smsvarsel",
            "title": "smsvarsel",
            "description": "Informasjon om hvordan man skal varsle sluttbruker på epost",
            "$comment": "Beskriver når det skal sendes epostvarsel fra postkassen etter at posten er tilgjengeliggjort",
            "properties": {
                "mobiltelefonnummer": {
                    "type": "string",
                    "minLength": 8,
                    "maxLength": 20,
                    "pattern": "^\\+?[- _0-9]+$"
                },
                "varslingstekst": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 160
                },
                "spraak": {
                    "$ref": "#/definitions/spraak"
                },
                "repetisjoner": {
                    "$ref": "#/definitions/repetisjoner"
                }
            },
            "required": [
                "mobiltelefonnummer",
                "varslingstekst",
                "spraak",
                "repetisjoner"
            ]
        }
    },
    "type": "object",
    "properties": {
        "standardBusinessDocument": {
            "$ref": "#/definitions/standardBusinessDocument"
        }
    },
    "additionalProperties": false
}